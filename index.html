---
layout: default
title: Home
description: Starphleet Documentation
isHome: true
---

<section class="bs-docs-section">
  <h1 id="overview" class="page-header">Overview</h1>
  <blockquote>
    <p>Starphleet is a toolkit for turning virtual or physical machine infrastructure into a continuous deployment stack, running multiple Git-backed services on one more nodes via Linux containers. </p>
    <p>Starphleet borrows heavily from the concepts of the Twelve-Factor App, and uses an approach that avoids many of the problems inherent in existing autodeployment solutions: </p>
  </blockquote>

  <ul>
    <li>Conventional virtualization, with multiple operating systems running on shared physical hardware, wastes resources, specifically RAM and CPU. This costs real money.</li>
    <li>Autodeploy PaaS has the same vendor lock-in risks of old proprietary software.</li>
    <li>Continuous deployment is almost always a custom scripting exercise.</li>
    <li>Multiple machine / clustered deployment is extra work.</li>
    <li>Making many small services is more work than making megalith services.</li>
    <li>Deployment systems all seem to be at the system not service level.</li>
    <li>Every available autodeploy system requires that you set up servers to deploy your servers, which themselves aren't autodeployed.</li>
  </ul>

  <h3 id="features">Features</h3>

  <ul>
    <li>Linux CGROUP and container isolation</li>
    <li>Continuous Deployment</li>
    <li>Centralized Configuration</li>
    <li>Easily combine many micro-services into a large application</li>
  </ul>

</section>

<section class="bs-docs-section">
  <h1 id="installation" class="page-header">Installation</h1>

  <h3 id="aws-install">EC2 in AWS</h3>
  <p>Starphleet includes <a href="https://aws.amazon.com">Amazon Web Services (AWS)</a> support. To initialize your phleet, you need to have an AWS account.</p>

  <ol>
    <li>Provision an Ubuntu EC2 Instance (Currently 14.04)</li>
    <li>Login to your provisioned instance</li>
    <li>Run the following command:</li>
  </ol>

  {% highlight bash %}
  bash -c "$(curl -s https://raw.githubusercontent.com/wballard/starphleet/master/webinstall)" {% endhighlight %}

  <h3 id="vmware-fusion-install">VMWare Fusion (Mac)</h3>
  <p>To install on a mac computer you will need the following software</p>

  <ul>
    <li><a href="http://www.vmware.com/go/try-fusion-en">VMWare Fusion v. &gt;= 8.1.0</a></li>
    <li><a href="http://store.vmware.com/store/vmware/en_US/home">VMWare Fusion License (Purchase Required)</a></li>
    <li><a href="https://www.vagrantup.com/downloads.html">Vagrant</a></li>
    <li><a href="http://docs.vagrantup.com/v2/vmware/installation.html">Vagrant VMWare Provider</a></li>
    <li><a href="http://www.vagrantup.com/vmware#buy-now">VMWare Provider License (Purchase Required)</a></li>
  </ul>

  <p>Once all the software is installed you can install starphleet into vmware with the following steps</p>

  <ol>
    <li>Clone the <a href="https://github.com/wballard/starphleet">GitHub repo</a> locally</li>
    <li>Change into the local directory</li>
    <li>Run the following command:</li>
  </ol>
  {% highlight bash %}
  ${PWD}/vmware" {% endhighlight %}
</section>
<section class="bs-docs-section">
  <h1 id="definitions" class="page-header">Definitions</h1>
  <h3 id="phleet">Phleet</h3>
  <p>A <a href="#phleet">phleet</a> is a grouping of <a href="#ship">starphleet ships</a>. The entire phleet points to a single <a href="#headquartersrepo">headquarters</a>. These ships may be geographically located for latency or maintained in a single region.
    A phleet is comprised of machines that are intended to be identical for easy scaling.
    <h3 id="ship">Ship</h3>
    <p>
      A ship is an Ubuntu 14.04 EC2 instance running a base install of Ubuntu. The starphleet installation will handle installing all needed software on the server.
    </p>
    <h3 id="headquartersrepo">Headquarters</h3>
    <p>
      The headquarters is a special <a href="https://github.com/wballard/starphleet.headquarters">Git repo</a> that is the <i>brains</i> of your <a href="#phleet">phleet</a>. The Headquarters will store all your environment and configuration options.
      This repo will also contain all your credentials and confidential information. It is important to keep your headquarter security restrictive. An example and template headquarters can be found <a href="https://github.com/wballard/starphleet.headquarters">here</a>.
    </p>
    <h3 id="orders">Orders</h3>
    <p>The orders file is a special file inside a subdirectory off the root directory of the <a href="#headquartersrepo">headquarters</a>.</p>

    <p>Each subdirectory off the root of the <a href="#headquartersrepo">headquarters</a> is checked for an <a href="#orders">orders file</a>. Starphleet will look inside the <a href="#orders">orders file</a> for deploy commands and environment variables for the service. There is a 1-1 mapping between the subdirectory that contains an <a href="#orders">orders file</a> and the url of the service deployed.</p>
    <h3 id="service">Service</h3>
    <p>Service STuff!</p>
    <h3 id="environmentvariables">Environment Variables</h3>
    <p>Environment STuff!</p>
    <h3 id="remotes">Remote</h3>
    <p>Remote STuff!</p>
  </p>
</section>

<section class="bs-docs-section">
  <h1 id="headquarters" class="page-header">Headquarters</h1>
  <p>
    The <a href="#headquartersrepo">Starphleet Headquarters</a> is a Git repo with all the master configurations for the entire phleet of servers.  It will contain the deploy commands for every service, keys for ssh console access to the ships, ssl certificates for the domain(s) you assign to the ship, configuration settings for authentication for each service as well as how the machine can reach LDAP servers, and any other major configuration item.
  </p>
  <p>
    Aside from special directories, each directory in the headquarters is assumed to be a <a href="#remote">remote</a> or <a href="#service">service</a>
  </p>
  <h3 id="reservedfiles">Reserved Files and Dirs</h3>
  <p>The Headquarters has the followin special directories and files outlined below:</p>
  <table class="table table-bordered table-striped">
    <thead>
      <tr>
        <th style="width: 130px;">Name</th>
        <th style="width: 50px;">Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>/hq/.starphleet</td>
        <td>file</td>
        <td>The .starphleet file is in the root of the headquarters and handles global environment configuration for services and starphleet.  This is where you'd override default starphleet configs for the entire phleet.</td>
      </tr>
      <tr>
        <td>/hq/authorized_keys</td>
        <td>dir</td>
        <td>The authorized_keys folder should container all the openssh public keys for users who want console access to the ships.  The users will all login as "admiral" using their associated private key</td>
      </tr>
      <tr>
        <td>/hq/beta_groups</td>
        <td>dir</td>
        <td>The beta_groups directory contains a list of files containing usernames inside the file.  The names of the files are used in the orders to setup beta groups</td>
      </tr>
      <tr>
        <td>/hq/ldap_servers</td>
        <td>dir</td>
        <td>The ldap_servers folder contains a list of files for all the ldap configurations used by the security system to secure services.  The name of the files are used inside the orders files to configure the security for an endpoint.</td>
      </tr>
      <tr>
        <td>/hq/overlay</td>
        <td>dir</td>
        <td>The overlay directory contains files intended to be dropped on to the file system of each ship.  Their is a direct relationship between the file structure of the overlay directory and the file structure of the ship</td>
      </tr>
      <tr>
        <td>/hq/ssl</td>
        <td>dir</td>
        <td>The ssl directory contains any of the SSL keys associated with the domains pointing to the ships in the phleet.</td>
      </tr>
    </tbody>
  </table>
  <h3 id="servicefiles">Service Files</h3>
  <p>To create a service endpoint you create a new directory off the root of the headquarters.  Inside the directory you create an orders file which contains configuration options and deploy commands for the service.  This file will tell Starphleet which Git repo to deploy at this endpoint.  The following is what the directory structure will look like along with a few of the files that might be associated with your service:</p>
    <table class="table table-bordered table-striped">
      <thead>
        <tr>
          <th style="width: 130px;">Name</th>
          <th style="width: 50px;">Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>/hq/$service</td>
          <td>dir</td>
          <td>Aside from the reserved files and directories in the headquarters each directory in your headquarters is considered a service endpoint.  These directories will correspond to a service that gets exposed via NGINX and inside the directories you will place files that contain all the environment and details for the service.</td>
        </tr>
        <tr>
          <td>/hq/service/orders</td>
          <td>file</td>
          <td>The orders file contains all the environment variables and <a href="#commands">Starphleet commands</a>to get a service or remote deployed.</td>
        </tr>
        <tr>
          <td>/hq/service/remote</td>
          <td>file</td>
          <td>There are times you may want to get data onto the server but the data is intended to be consumed by services.  These are called "remotes".  Just like a service, a remote is tracked for changes and automatically updated when the Git repo changes.  THe data is stored inside the container in "/var/data/$service".  $service corresponds with the service directory the remote file is located in.</td>
        </tr>
        <tr>
          <td>/hq/service/on_containerize</td>
          <td>file</td>
          <td><i>The on_containerize script must be checked into the headquarters as executable to be executed by Starphleet.</i>  When Starphleet downloads a service it will run through the built-in Heroku buildpacks and try to determine the type of application.  <b>Before</b> this process occurs, Starphleet will run the on_containerize script as root.  This script can run commands that might help setup the container before the buildpack begins.</td>
        </tr>
        <tr>
          <td>/hq/service/after_containerize</td>
          <td>file</td>
          <td><i>The after_containerize script must be checked into the headquarters as executable to be executed by Starphleet.</i>  When Starphleet downloads a service it will run through the built-in Heroku buildpacks and try to determine the type of application.  <b>After</b> this process occurs, Starphleet will run the after_containerize script as root.  This script can run commands that might help setup the container after the buildpack finishes.</td>
        </tr>
        <tr>
          <td>/hq/service/$cron_file</td>
          <td>file</td>
          <td><i>$Cron jobs must be checked into the headquarters as executable to be executed by Starphleet.</i>  See <a href="cronjobs">cron jobs</a>for more information</td>
        </tr>
      </tbody>
    </table>
    <h3 id="orderscommands">Orders Commands</h3>
    <p>There are some special commands that can be access via the orders file.  These commands can also be available in scripts by sourcing <b>/usr/bin/tools</b>.  Commands are:</p>
    <table class="table table-bordered table-striped">
      <thead>
        <tr>
          <th style="width: 130px;">Command</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>autodeploy</td>
          <td>This command is passed a single argument which is a link to a github repo.  If the repo is private, the link must be an SSH link and Starphleet must have an SSH key installed with access to the repo.  This command will build a container, run your application, and if successfully completed, mount the application to the path corresponding to the location of the orders file.</td>
        </tr>
        <tr>
          <td>expose</td>
          <td>Some services that run in a container need special ports exposed outside of the machine.  Expose will open a hole in the local machine's firewall and forward traffic destined for the exposed port directly into the container.</td>
        </tr>
        <tr>
          <td>unpublished</td>
          <td>Starphleet will create a container at the location corresponding with the path to the orders file but will not expose the service for web traffic.</td>
        </tr>
      </tbody>
    </table>
    <h3 id="ordersvariables">Orders Variables</h3>
    <p>All variables need to be exported to be available to your application.  For instance:</p>
    <p><code>export FOO="BAR"</code></p>
    <p>Variables are available to your application.  Some variables are exposed to your application by Starphleet and can be overridden in your headquarters</p>
    <table class="table table-bordered table-striped">
      <thead>
        <tr>
          <th style="width: 130px;">Variable</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>PORT</td>
          <td>This command is passed a single argument which is a link to a github repo.  If the repo is private, the link must be an SSH link and Starphleet must have an SSH key installed with access to the repo.  This command will build a container, run your application, and if successfully completed, mount the application to the path corresponding to the location of the orders file.</td>
        </tr>
        <tr>
          <td>SECURITY_MODE</td>
          <td>Some services that run in a container need special ports exposed outside of the machine.  Expose will open a hole in the local machine's firewall and forward traffic destined for the exposed port directly into the container.</td>
        </tr>
        <tr>
          <td>$ANY_OTHER</td>
          <td>Starphleet will create a container at the location corresponding with the path to the orders file but will not expose the service for web traffic.</td>
        </tr>
        <tr>
          <td>PORT</td>
          <td></td>
        </tr>
        <tr>
          <td>LXC_ROOT</td>
          <td></td>
        </tr>
        <tr>
          <td>STARPHLEET_SHARED_DATA</td>
          <td></td>
        </tr>
        <tr>
          <td>STARPHLEET_PULSE</td>
          <td></td>
        </tr>
        <tr>
          <td>STARPHLEET_DRAINSTOP_WAIT</td>
          <td></td>
        </tr>
        <tr>
          <td>STARPHLEET_ROOT</td>
          <td></td>
        </tr>
        <tr>
          <td>HEADQUARTERS_SOURCE</td>
          <td></td>
        </tr>
        <tr>
          <td>HEADQUARTERS_LOCAL</td>
          <td></td>
        </tr>
        <tr>
          <td>HEADQUARTERS_ENV</td>
          <td></td>
        </tr>
        <tr>
          <td>SHIP_SCRIPTS</td>
          <td></td>
        </tr>
        <tr>
          <td>CURRENT_ORDERS</td>
          <td></td>
        </tr>
        <tr>
          <td>PRIVATE_KEYS</td>
          <td></td>
        </tr>
        <tr>
          <td>PUBLIC_KEYS</td>
          <td></td>
        </tr>
        <tr>
          <td>NGINX_CONF</td>
          <td></td>
        </tr>
        <tr>
          <td>STARPHLEET_APP_USER</td>
          <td></td>
        </tr>
        <tr>
          <td>USER_IDENTITY_HEADER</td>
          <td></td>
        </tr>
        <tr>
          <td>USER_IDENTITY_COOKIE</td>
          <td></td>
        </tr>
        <tr>
          <td>NGINX_PUBLISHED_PATH</td>
          <td></td>
        </tr>
        <tr>
          <td>NGINX_STATUS_CONFIG_SYMLINK</td>
          <td></td>
        </tr>
        <tr>
          <td>NGINX_STATUS_ENDPOINT_CONFIG</td>
          <td></td>
        </tr>
        <tr>
          <td>STARPHLEET_DNS_ONLINE_STATUS_FILE</td>
          <td></td>
        </tr>
        <tr>
          <td>SECURITY_MODE</td>
          <td></td>
        </tr>
        <tr>
          <td>LDAP_SERVER</td>
          <td></td>
        </tr>
        <tr>
          <td>JWT_SECRET</td>
          <td></td>
        </tr>
        <tr>
          <td>JWT_AUTH_SITE</td>
          <td></td>
        </tr>
        <tr>
          <td>JWT_COOKIE_DOMAIN</td>
          <td></td>
        </tr>
        <tr>
          <td>JWT_ROLES</td>
          <td></td>
        </tr>
        <tr>
          <td>HTPASSWD</td>
          <td></td>
        </tr>
      </tbody>
    </table>
  </section>
  <section class="bs-docs-section">
    <h1 id="commands" class="page-header">Commands</h1>
    <h3 id="commandlinecommands">Command Line</h3>
    <p>All variables need to be exported to be available to your application.  For instance '<i>export FOO="BAR"</i>'.  Variables are available to your application.  Some variables are exposed to your application by Starphleet and can be overridden in your headquarters</p>
    <table class="table table-bordered table-striped">
      <thead>
        <tr>
          <th style="width: 180px;">Command</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>starphleet-attach</td>
          <td></td>
        </tr>
        <tr>
          <td>starphleet-dns-offline</td>
          <td></td>
        </tr>
        <tr>
          <td>starphleet-dns-online</td>
          <td></td>
        </tr>
        <tr>
          <td>starphleet-git</td>
          <td></td>
        </tr>
        <tr>
          <td>starphleet-headquarters</td>
          <td></td>
        </tr>
        <tr>
          <td>starphleet-hup-nginx</td>
          <td></td>
        </tr>
        <tr>
          <td>starphleet-orphan-reaper</td>
          <td></td>
        </tr>
        <tr>
          <td>starphleet-redeploy</td>
          <td></td>
        </tr>
        <tr>
          <td>starphleet-restart-nginx</td>
          <td></td>
        </tr>
        <tr>
          <td>starphleet-retry-deploy</td>
          <td></td>
        </tr>
        <tr>
          <td>starphleet-status</td>
          <td></td>
        </tr>
      </tbody>
    </table>
  </section>
  <section class="bs-docs-section">
    <h1 id="buildpacks" class="page-header">Buildpacks</h1>
    <h3 id="howbuildpackswork">How Buildpacks Work</h3>
    <p>Buildpacks autodetect and provision services in containers for you. We would like to give a huge thanks to Heroku for having open buildpacks, and to the open source community for making and extending them. The trick that makes the Starphleet orders file so simple is the use of buildpacks and platform package managers to install dynamic, service specific code, such as rubygems or npm and associated dependencies, that may vary with each push of your service. Note that <b>Starphleet will only deploy one buildpack per Linux container</b> - for services which are written in multiple languages, custom buildpacks may be required.</p>
    <p>Starphleet currently includes support for Ruby, Python, NodeJS, and NGINX static buildpacks.</p>
    <h3 id="defaultbuildpacks">Default Buildpacks</h3>
    <table class="table table-bordered table-striped">
      <thead>
        <tr>
          <th style="width: 130px;">Buildpack</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><a href="https://github.com/igroff/heroku-buildpack-ruby">Ruby</a></td>
          <td> This will run bundle install and make use of your Procfile. </td>
        </tr>
        <tr>
          <td><a href="https://github.com/igroff/heroku-buildpack-python">Python</a></td>
          <td>TODO: Fill in</td>
        </tr>
        <tr>
          <td><a href="https://github.com/igroff/heroku-buildpack-nodejs">NodeJS</a></td>
          <td>TODO: Fill In</td>
        </tr>
        <tr>
          <td><a href="https://github.com/wballard/nginx-buildpack">NGINX</a></td>
          <td>Detect an index.html file and service static contact.</td>
        </tr>
      </tbody>
    </table>
  </section>
  <section class="bs-docs-section">
    <h1 id="security" class="page-header">Security</h1>
    <h3 id="securitysettings">Security Settings</h3>
    <p>All variables need to be exported to be available to your application.  For instance '<i>export FOO="BAR"</i>'.  Variables are available to your application.  Some variables are exposed to your application by Starphleet and can be overridden in your headquarters</p>
    <table class="table table-bordered table-striped">
      <thead>
        <tr>
          <th style="width: 130px;">Variable</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>PORT</td>
          <td>This command is passed a single argument which is a link to a github repo.  If the repo is private, the link must be an SSH link and Starphleet must have an SSH key installed with access to the repo.  This command will build a container, run your application, and if successfully completed, mount the application to the path corresponding to the location of the orders file.</td>
        </tr>
        <tr>
          <td>SECURITY_MODE</td>
          <td>Some services that run in a container need special ports exposed outside of the machine.  Expose will open a hole in the local machine's firewall and forward traffic destined for the exposed port directly into the container.</td>
        </tr>
        <tr>
          <td>$ANY_OTHER</td>
          <td>Starphleet will create a container at the location corresponding with the path to the orders file but will not expose the service for web traffic.</td>
        </tr>
        <tr>
          <td>PORT</td>
          <td></td>
        </tr>
        <tr>
          <td>LXC_ROOT</td>
          <td></td>
        </tr>
        <tr>
          <td>STARPHLEET_SHARED_DATA</td>
          <td></td>
        </tr>
        <tr>
          <td>STARPHLEET_PULSE</td>
          <td></td>
        </tr>
        <tr>
          <td>STARPHLEET_DRAINSTOP_WAIT</td>
          <td></td>
        </tr>
        <tr>
          <td>STARPHLEET_ROOT</td>
          <td></td>
        </tr>
        <tr>
          <td>HEADQUARTERS_SOURCE</td>
          <td></td>
        </tr>
        <tr>
          <td>HEADQUARTERS_LOCAL</td>
          <td></td>
        </tr>
        <tr>
          <td>HEADQUARTERS_ENV</td>
          <td></td>
        </tr>
        <tr>
          <td>SHIP_SCRIPTS</td>
          <td></td>
        </tr>
        <tr>
          <td>CURRENT_ORDERS</td>
          <td></td>
        </tr>
        <tr>
          <td>PRIVATE_KEYS</td>
          <td></td>
        </tr>
        <tr>
          <td>PUBLIC_KEYS</td>
          <td></td>
        </tr>
        <tr>
          <td>NGINX_CONF</td>
          <td></td>
        </tr>
        <tr>
          <td>STARPHLEET_APP_USER</td>
          <td></td>
        </tr>
        <tr>
          <td>USER_IDENTITY_HEADER</td>
          <td></td>
        </tr>
        <tr>
          <td>USER_IDENTITY_COOKIE</td>
          <td></td>
        </tr>
        <tr>
          <td>NGINX_PUBLISHED_PATH</td>
          <td></td>
        </tr>
        <tr>
          <td>NGINX_STATUS_CONFIG_SYMLINK</td>
          <td></td>
        </tr>
        <tr>
          <td>NGINX_STATUS_ENDPOINT_CONFIG</td>
          <td></td>
        </tr>
        <tr>
          <td>STARPHLEET_DNS_ONLINE_STATUS_FILE</td>
          <td></td>
        </tr>
        <tr>
          <td>SECURITY_MODE</td>
          <td></td>
        </tr>
        <tr>
          <td>LDAP_SERVER</td>
          <td></td>
        </tr>
        <tr>
          <td>JWT_SECRET</td>
          <td></td>
        </tr>
        <tr>
          <td>JWT_AUTH_SITE</td>
          <td></td>
        </tr>
        <tr>
          <td>JWT_COOKIE_DOMAIN</td>
          <td></td>
        </tr>
        <tr>
          <td>JWT_ROLES</td>
          <td></td>
        </tr>
        <tr>
          <td>HTPASSWD</td>
          <td></td>
        </tr>
      </tbody>
    </table>
</section>
<section class="bs-docs-section">
  <h1 id="healthchecks" class="page-header">Healthchecks</h1>
  <h3 id="howhealthchecksworks">How They Work</h3>
  <h3 id="howtousehealthchecks">How To Use</h3>
</section>
<section class="bs-docs-section">
  <h1 id="cronjobs" class="page-header">Cron Jobs</h1>
  <h3 id="howcronworks">How They Work</h3>
  <h3 id="howtousecron">How To Use</h3>
</section>
<section class="bs-docs-section">
  <h1 id="devmode" class="page-header">Development Mode</h1>
  <h3 id="whatisdevmode">What Is It</h3>
  <h3 id="howdevmodeworks">How It Works</h3>
</section>
